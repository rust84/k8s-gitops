ingress:
  annotations:
    external-dns.alpha.kubernetes.io/target: "ipv4.$DOMAIN"
  hosts:
    - host: "dex.$DOMAIN"
      paths:
        - path: /
          pathType: Prefix
  tls:
    - hosts:
        - "dex.$DOMAIN"
config:
  connectors:
    # GitHub configure 'OAuth Apps' -> 'New OAuth App', add callback URL
    # https://github.com/settings/developers
    - type: github
      id: github
      name: GitHub
      config:
        clientID: $DEX_GITHUB_CLIENT_ID
        clientSecret: $DEX_GITHUB_CLIENT_SECRET
        redirectURI: https://dex.$DOMAIN/callback
        # 'orgs' can be used to map groups from Github
        # https://github.com/coreos/dex/blob/master/Documentation/connectors/github.md
        orgs:
        - name: russhome

  staticClients:
    - id: dex-k8s-authenticator
      name: dex-k8s-authenticator
      secret: $DEX_K8S_AUTHENTICATOR_CLIENT_SECRET
      redirectURIs:
        - https://login.$DOMAIN/callback/

    - id: grafana
      name: grafana
      secret: $DEX_GRAFANA_AUTHENTICATOR_CLIENT_SECRET
      redirectURIs:
      - 'https://grafana.$DOMAIN/login/generic_oauth'
      
    - id: authentik
      name: authentik
      secret: $DEX_AUTHENTIK_CLIENT_SECRET
      redirectURIs:
        - https://id.$DOMAIN/source/oauth/callback/dex/