alertmanager:
  ingress:
    hosts: [prom-alert.$DOMAIN]
    tls:
    - hosts:
      - prom-alert.$DOMAIN
  config:
    global:
      slack_api_url: "$DISCORD_WEBOOK_URL"
    receivers:
    - name: 'null'
    - name: 'slack-monitoring'
      slack_configs:
      - channel: '#alerts'
        send_resolved: true
        title: '{{ template "slack.title" . }}'
        icon_emoji: ':prometheus:'
        color: '{{ template "slack.color" . }}'
        text: '{{ template "slack.text" . }}'
        actions:
        - type: button
          text: 'Runbook :green_book:'
          url: '{{ (index .Alerts 0).Annotations.runbook_url }}'
        - type: button
          text: 'Query :mag:'
          url: '{{ (index .Alerts 0).GeneratorURL }}'
        - type: button
          text: 'Silence :no_bell:'
          url: '{{ template "__alert_silence_link" . }}'
    - name: 'pagerduty'
      pagerduty_configs:
        - routing_key: $PD_TOKEN
          description: |-
            {{ template "pagerduty.custom.description" . }}
prometheus:
  ingress:
    hosts: [prom-server.$DOMAIN]
    tls:
    - hosts:
      - prom-server.$DOMAIN
  prometheusSpec:
    additionalScrapeConfigs:
      - job_name: "emqx"
        metrics_path: '/api/v4/emqx_prometheus'
        basic_auth:
          username: admin
          password: public
        params:
          type: [prometheus]
        honor_labels: true
        static_configs:
          - targets:
              - emqx.default.svc:8081
      - job_name: 'home-assistant'
        scrape_interval: 60s
        metrics_path: '/api/prometheus'
        bearer_token: '$PROM_HASS_TOKEN'
        scheme: http
        static_configs:
        - targets:
          - home-assistant.default.svc:8123