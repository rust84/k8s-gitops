# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: homepage-secrets
spec:
  refreshInterval: 5m
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: homepage-secrets
    template:
      data:
        # Media arr apps (from 'arrs' key)
        HOMEPAGE_VAR_SONARR_API_KEY: "{{ .SONARR__API_KEY }}"
        HOMEPAGE_VAR_RADARR_API_KEY: "{{ .RADARR__API_KEY }}"
        HOMEPAGE_VAR_PROWLARR_API_KEY: "{{ .PROWLARR__API_KEY }}"
        # Seerr (from 'seerr' key)
        HOMEPAGE_VAR_SEERR_API_KEY: "{{ .JELLYSEERR_API_KEY }}"
        # Plex (from 'plex' key)
        HOMEPAGE_VAR_PLEX_TOKEN: "{{ .PLEX_TOKEN }}"
        # SABnzbd (from 'sabnzbd' key)
        HOMEPAGE_VAR_SABNZBD_API_KEY: "{{ .SABNZBD_API_KEY }}"
        # Tautulli (from 'tautulli' key - needs to be added to OnePassword)
        HOMEPAGE_VAR_TAUTULLI_API_KEY: "{{ .TAUTULLI_API_KEY }}"
        # Home Assistant (from 'home-assistant' key - needs long-lived token added)
        HOMEPAGE_VAR_HOMEASSISTANT_TOKEN: "{{ .HASS_TOKEN }}"
        # Home Assistant location (from 'home-assistant' key)
        HOMEPAGE_VAR_HASS_LATITUDE: "{{ .HASS_LATITUDE }}"
        HOMEPAGE_VAR_HASS_LONGITUDE: "{{ .HASS_LONGITUDE }}"
        # Uptime Kuma (from 'uptime-kuma' key - needs status page slug added)
        HOMEPAGE_VAR_UPTIMEKUMA_SLUG: "{{ .UPTIMEKUMA_SLUG }}"
    creationPolicy: Owner
  dataFrom:
    - extract:
        key: arrs
    - extract:
        key: seerr
    - extract:
        key: plex
    - extract:
        key: sabnzbd
    - extract:
        key: tautulli
    - extract:
        key: home-assistant
    - extract:
        key: uptime-kuma
