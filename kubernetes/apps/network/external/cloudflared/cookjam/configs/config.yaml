---
# NOTE: originServerName removed - envoy gateway uses SNI to match listeners,
# so cloudflared must use the actual hostname (e.g., cookjam.uk) not a fixed
# value, otherwise envoy returns 404 (route_not_found)
# originRequest:
#   originServerName: "external.${SECRET_APP_DOMAIN}"

ingress:
  # CNPG Pooler for database access
  - hostname: "postgres.${SECRET_APP_DOMAIN}"
    service: tcp://postgres-cookjam-pooler.database.svc.cluster.local:5432
  # Main application ingress
  - hostname: "${SECRET_APP_DOMAIN}"
    service: https://envoy-external.network.svc.cluster.local:443
    originRequest:
      noTLSVerify: true
  - hostname: "*.${SECRET_APP_DOMAIN}"
    service: https://envoy-external.network.svc.cluster.local:443
    originRequest:
      noTLSVerify: true
  - hostname: "${SECRET_APP_PRD_DOMAIN}"
    service: https://envoy-external.network.svc.cluster.local:443
    originRequest:
      noTLSVerify: true
  - hostname: "*.${SECRET_APP_PRD_DOMAIN}"
    service: https://envoy-external.network.svc.cluster.local:443
    originRequest:
      noTLSVerify: true
  - service: http_status:404
