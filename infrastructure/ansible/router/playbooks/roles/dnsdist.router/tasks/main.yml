---
- name: Create dnsdist log rotation config
  ansible.builtin.template:
    src: dnsdist-newsyslog.conf.j2
    dest: /etc/newsyslog.conf.d/dnsdist
    mode: 0755

- name: Configure dnsdist
  notify: Restart dnsdist
  block:
    - name: Create Corefile
      ansible.builtin.template:
        src: Corefile.j2
        dest: /usr/local/etc/dnsdist/Corefile
        mode: 0755
    - name: Create dnsdist rc.conf script
      ansible.builtin.template:
        src: dnsdist-rc.conf.j2
        dest: /etc/rc.conf.d/dnsdist
        mode: 0755
    - name: Create dnsdist rc.d script
      ansible.builtin.template:
        src: dnsdist-rc.d.j2
        dest: /usr/local/etc/rc.d/dnsdist
        mode: 0755
    - name: Create dnsdist action script
      ansible.builtin.template:
        src: actions_dnsdist.conf.j2
        dest: /usr/local/opnsense/service/conf/actions.d/actions_dnsdist.conf
        mode: 0755
    - name: Create dnsdist start up script
      ansible.builtin.template:
        src: 99-dnsdist.j2
        dest: /usr/local/etc/rc.syshook.d/start/99-dnsdist
        mode: 0755
